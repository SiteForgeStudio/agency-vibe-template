---
/**
 * INDEX.ASTRO - The Universal Factory Canvas
 * Fixed: Now passes the Client ID to isolated components to enable image discovery.
 */
 import { getClientData } from '../lib/dataFetcher';
import Layout from '../layouts/Layout.astro';
import Navbar from '../components/Navbar.astro';
import Footer from '../components/Footer.astro';
import Hero from '../components/Hero.astro';
import Trustbar from '../components/TrustBar.astro';
import Events from '../components/Events.astro';
import BentoAbout from '../components/BentoAbout.astro';
import Features from '../components/Features.astro';
import Process from '../components/Process.astro';
import Testimonials from '../components/Testimonials.astro';
import Comparison from '../components/Comparison.astro';
import Gallery from '../components/Gallery.astro';
import Investment from '../components/Investment.astro';
import FAQ from '../components/FAQ.astro';
import Contact from '../components/Contact.astro';
import ServiceArea from '../components/ServiceArea.astro';

// 1. DYNAMIC HANDSHAKE
const data = getClientData();

// Capture the ID for asset isolation logic
const clientId = data.id;

const {
  intelligence = {},
  strategy = {},
  settings = {},
  brand = {},
  about = {},
  hero = {},
  trustbar = null,
  events = [],
  features = [],
  processSteps = [],
  testimonials = [],
  comparison = null,
  gallery = null,
  investment = [],
  faqs = [],
  service_area = [],
  contact = {}
} = data;

const navMenu = settings.menu || [];
const siteTitle = brand.name ? `${brand.name} | ${brand.tagline || 'Professional Services'}` : "Vibe-Engine Production";
---

<Layout title={siteTitle} settings={settings}>
  <Navbar brand={brand} menu={navMenu} settings={settings} />

  <main>
    {/* 1. HERO SECTION - Now receiving the ID */}
    <Hero hero={hero} brand={brand} settings={settings} id={clientId} />

    {/* 1.25 TRUSTBAR */}
    {strategy.show_trustbar && trustbar?.enabled && (trustbar?.items?.length > 0 || trustbar?.computed_count > 0) && (
      <Trustbar data={trustbar} />
    )}

    {/* 1.5 THE BENTO ABOUT */}
    {strategy.show_about !== false && (brand.name || about.story_text) && (
      <BentoAbout brand={brand} about={about} intelligence={intelligence} />
    )}

    {/* 2. FEATURES / SERVICES */}
    {strategy.show_features && features.length > 0 && (
      <Features features={features} intelligence={intelligence} />
    )}

    {/* 2.5 EVENTS / CLASSES */}
    {strategy.show_events && events.length > 0 && (
      <Events events={events} />
    )}

    {/* 3. METHODOLOGY / PROCESS */}
    {strategy.show_process && processSteps.length > 0 && (
      <Process steps={processSteps} intelligence={intelligence} />
    )}

    {/* 4. SOCIAL PROOF */}
    {strategy.show_testimonials && testimonials.length > 0 && (
      <Testimonials testimonials={testimonials} />
    )}

    {/* 5. VALUE COMPARISON */}
    {strategy.show_comparison && comparison && (
      <Comparison comparison={comparison} intelligence={intelligence} />
    )}

    {/* 6. PORTFOLIO / GALLERY - Now receiving the ID */}
    {strategy.show_gallery && gallery?.enabled !== false && (gallery?.items?.length > 0 || gallery?.computed_count > 0) && (
      <Gallery gallery={gallery} brand={brand} id={clientId} />
    )}

    {/* 7. PRICING / INVESTMENT */}
    {strategy.show_investment && investment.length > 0 && (
      <Investment tiers={investment} brand={brand} />
    )}

    {/* 8. OBJECTION HANDLING */}
    {strategy.show_faqs && faqs.length > 0 && <FAQ faqs={faqs} />}

    {/* 8.5 SERVICE AREA */}
    {strategy.show_service_area && service_area.length > 0 && (
      <ServiceArea service_area={service_area} intelligence={intelligence} />
    )}

    {/* 9. FINAL CONVERSION */}
    <Contact contact={contact} intelligence={intelligence} brand={brand} settings={settings} />
  </main>

  <Footer brand={brand} settings={settings} />
</Layout>