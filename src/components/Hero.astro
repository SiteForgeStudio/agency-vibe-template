---
/**
 * COMPONENT: Hero
 * Standards: 2026 Vibe-Engine / Dynamic Factory Discovery
 * Logic: Filtered Globbing for Clean builds & 100/100 Lighthouse
 */
 import { Image } from 'astro:assets';
import type { ImageMetadata } from 'astro';

const { brand, hero, settings } = Astro.props;
const clientId = process.env.CLIENT_ID;

// 1. DYNAMIC IMAGE DISCOVERY (Factory Standard)
// We look into the clients folder specifically to keep /src/ clean
const images = import.meta.glob<{ default: ImageMetadata }>('/clients/*/assets/images/*.{jpeg,jpg,png,gif,webp}');

// 2. CONSTRUCT THE MATCHING PATH
// This matches the fetcher script: /clients/slug/assets/images/slug-hero.jpg
const expectedPath = `/clients/${clientId}/assets/images/${brand?.slug}-hero.jpg`;
const imageAsset = images[expectedPath];

// 3. SAFE CONTENT DEFAULTS
const headline = hero?.headline || brand?.tagline || "Quality at AI Speed";
const subtext = hero?.subtext || "Professional Astro architecture delivered in 24 hours.";

// 4. PRIMARY CTA LOGIC
const rawCtaLink = settings?.cta_link || "#contact";
const isCtaDisabled = rawCtaLink.toLowerCase() === 'n/a';
const finalCtaLink = isCtaDisabled ? "#contact" : rawCtaLink;
const finalCtaType = isCtaDisabled ? "anchor" : (settings?.cta_type || "anchor");
const isPrimaryExternal = finalCtaType === 'external' && finalCtaLink.startsWith('http');
const ctaText = settings?.cta_text || "Get Started";

// 5. SECONDARY CTA LOGIC
const hasSecondary = settings?.secondary_cta_text && settings?.secondary_cta_link && settings.secondary_cta_link.toLowerCase() !== 'n/a';
const isSecondaryExternal = settings?.secondary_cta_link?.startsWith('http');
---

<section id="home" class="relative min-h-[90vh] flex items-center justify-center overflow-hidden bg-[var(--bg-color)]">
  
  <div class="absolute inset-0 z-0">
    {imageAsset ? (
      <Image 
        src={imageAsset()} 
        alt={hero?.image?.alt || brand?.name || "Hero Background"} 
        widths={[800, 1200, 1920]}
        sizes="100vw"
        class="w-full h-full object-cover opacity-30 md:opacity-40"
        loading="eager"
        fetchpriority="high"
      />
    ) : (
      <div class="w-full h-full opacity-20 bg-[radial-gradient(circle_at_top_right,var(--accent)_0%,transparent_60%)]"></div>
    )}
    <div class="absolute inset-0 bg-gradient-to-b from-[var(--bg-color)]/20 via-[var(--bg-color)]/40 to-[var(--bg-color)]"></div>
  </div>

  <div class="container relative z-10 px-6 mx-auto text-center">
    <div class="flex items-center justify-center gap-3 mb-8">
       <span class="h-[1px] w-4 bg-[var(--accent)]"></span>
       <p class="text-[10px] font-bold tracking-[0.4em] uppercase text-[var(--accent)]">
        {brand?.availability_status || brand?.name || "System Active"}
       </p>
       <span class="h-[1px] w-4 bg-[var(--accent)]"></span>
    </div>
    
    <h1 class="text-5xl sm:text-6xl md:text-7xl lg:text-8xl font-black uppercase tracking-tighter leading-[0.85] text-[var(--text-primary)] mb-8">
        {headline}
    </h1>

    <p class="max-w-2xl mx-auto mb-12 text-lg md:text-xl text-[var(--text-secondary)] leading-relaxed font-medium opacity-80">
      {subtext}
    </p>

    <div class="flex flex-col items-center gap-10">
      <div class="flex flex-col sm:flex-row items-center gap-4">
        <a 
          href={finalCtaLink} 
          target={isPrimaryExternal ? "_blank" : "_self"}
          rel={isPrimaryExternal ? "noopener noreferrer" : ""}
          class="w-full sm:w-auto bg-[var(--accent)] px-12 py-5 text-[10px] font-black uppercase tracking-[0.2em] transition-all hover:scale-105 active:scale-95 rounded-[var(--radius)] inline-block text-black shadow-xl shadow-[var(--accent)]/10"
        >
          {ctaText}
        </a>

        {hasSecondary && (
          <a 
            href={settings.secondary_cta_link}
            target={isSecondaryExternal ? "_blank" : "_self"}
            rel={isSecondaryExternal ? "noopener noreferrer" : ""}
            class="w-full sm:w-auto border border-[var(--border)] bg-white/5 backdrop-blur-sm px-12 py-5 text-[10px] font-black uppercase tracking-[0.2em] transition-all hover:bg-[var(--text-primary)] hover:text-[var(--bg-color)] rounded-[var(--radius)] inline-block text-[var(--text-primary)]"
          >
            {settings.secondary_cta_text}
          </a>
        )}
      </div>
      
      {brand?.objection_handle && (
        <span class="text-[10px] uppercase tracking-[0.25em] opacity-50 flex items-center gap-4 text-[var(--text-primary)] font-bold italic">
          {brand.objection_handle}
        </span>
      )}
    </div>
  </div>
</section>